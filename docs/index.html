<!doctype html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Notes on learning concurrent programming in Swift from WWDC21</title><script defer="defer" src="js/main.js"></script><link href="css/main.css" rel="stylesheet"></head><body><section class="min-h-screen bg-gray-900 text-white flex items-center"><div class="container my-12 md:my-20 lg:my-32"><div class="grid md:grid-cols-2 gap-6"><div><header><span class="text-secondary">Swift</span><h1 class="text-6xl font-bold font-mono">try await</h1></header><blockquote class="my-12">Using async/await in Swift, write asynchronous code just as easily as you write regular code. And when you do, your code will better reflect your ideas. it will be safer too.</blockquote><a class="play-btn" href="#meet_async_await_in_swift">Meet async/await in Swift</a></div><div class="codes-wrapper"><pre><code class="language-swift">func fetchThumbnail(for id: String) async throws -> UIImage {
    let request = thumbnailURLRequest(for: id)
    let (data, response) = try await URLSession.shared.data(for: request)
    guard (response as? HTTPURLResponse)?.statusCode == 200 else { throw FetchError.badID }
    let maybeImage = UIImage(data: data)
    guard let thumbnail = await maybeImage?.thumbnail else { throw FetchError.badImage }
    return thumbnail
}</code></pre></div></div><div class="py-6 mt-12 md:mt-20 lg:mt-32 border-t md:border-b border-color-white"><span class="font-bold">Async APIs in the SDK</span> / NSDocument / UIDocument / HKHealthStore / CKContainer / MKDirections / SCNSceneRender / AVPlayer / CLKComplicationDataSource / ENManager / TimelineProvider / URLSession / MPMuscirPlayerController / OCKStore / PHAssetResourceManager</div></div></section><section class="section"><div class="container"><h2 class="text-4xl font-medium text-center" id="meet_async_await_in_swift">Meet async/await in Swift</h2><blockquote class="max-w-prose my-4 md:my-6 lg:my-10 mx-auto text-center">Swift now supports asynchronous functions — a pattern commonly known as async/await. Discover how the new syntax can make your code easier to read and understand. Learn what happens when a function suspends, and find out how to adapt existing completion handlers to asynchronous functions.</blockquote><p class="text-center"><video controls="" src="https://devstreaming-cdn.apple.com/videos/wwdc/2021/10132/4/B2DD09FD-0D18-4E24-82C2-0736DF914F66/cmaf.m3u8"></video><cite class="my-3 text-secondary text-sm"><a href="https://developer.apple.com/videos/play/wwdc2021/10132/" target="_blank">WWDC21: Meet async/await in Swift</a></cite></p><h3 class="mt-10 md:mt-12 lg:mt-15 text-2xl">Notes</h3><div class="notes" data-time="510"><div class="notes__content"><p>Calling synchronous function blocks your thread.</p><p>Asynchronous function unblocks your thread. Asynchronous function uses completion handler or delegate callback to notify the result.</p><p>Now you can mark a function async and just return a result.</p><p>You can also throw an error in an async function.</p><p>Async/await in Swift makes code safer, shorter, and makes it better reflect your intent.</p></div><div class="codes-wrapper"><pre><code class="language-swift">func fetchThumbnail(for id: String) async throws -&gt; UIImage {
    let request = thumbnailURLRequest(for: id)
    let (data, response) = try await URLSession.shared.data(for: request)
    guard (response as? HTTPURLResponse)?.statusCode == 200 else { throw FetchError.badID }
    let maybeImage = UIImage(data: data)
    guard let thumbnail = await maybeImage?.thumbnail else { throw FetchError.badImage }
    return thumbnail
}
</code></pre></div></div><div class="notes" data-time="781"><div class="notes__content"><p>Properties can be async too, so can initializers.</p><p>The property must have an explicit getter.</p><p>The property has no setter, that means only read-only property can be async.</p></div><div class="codes-wrapper"><pre><code class="language-swift">extension UIImage {
    var thumbnail: UIImage? {
        get async {
            let size = CGSize(width: 40, height: 40)
            return await self.byPreparingThumbnail(ofSize: size)
        }
    }
}
</code></pre></div></div><div class="notes" data-time="856"><div class="notes__content"><p>Await works in for loops to iterate over async sequences.</p><p>An async sequence vends its elements asynchronously.</p><p><a href="#meet_asyncsequence">Learn more about AsyncSequence</a>.</p></div><div class="codes-wrapper"><pre><code class="language-swift">for await id in staticImageIDsURL.lines {
    let thumbnail = await fetchThumbnail(for: id)
    collage.add(thumbnail)
}
let result = collage.draw()
</code></pre></div></div><div class="notes" data-time="1203"><div class="notes__content"><blockquote><p><code>async</code> enables a function to suspend.<br><code>await</code> marks where an async function may suspend execution.<br>Other work can happen during a suspension.<br>Once an awaited async call completes, execution resumes after the <code>await</code>.</p></blockquote></div></div></div></section><section class="section bg-green-50"><div class="container"><h2 class="text-4xl font-medium text-center" id="meet_asyncsequence">Meet AsyncSequence</h2><blockquote class="max-w-prose my-4 md:my-6 lg:my-10 mx-auto text-center">Iterating over a sequence of values over time is now as easy as writing a “for” loop. Find out how the new AsyncSequence protocol enables a natural, simple syntax for iterating over anything from notifications to bytes being streamed from a server. We'll also show you how to adapt existing code to provide asynchronous sequences of your own.</blockquote><p class="text-center"><video controls="" src="https://devstreaming-cdn.apple.com/videos/wwdc/2021/10058/5/A934E650-C91D-4C63-AC83-A8980D052B5B/cmaf.m3u8"></video><cite class="my-3 text-secondary text-sm"><a href="https://developer.apple.com/videos/play/wwdc2021/10058" target="_blank">WWDC21: Meet AsyncSequence</a></cite></p><h3 class="mt-10 md:mt-12 lg:mt-15 text-2xl">Notes</h3><div data-notes="meet_asyncsequence" class="notes text-secondary">To be continued...</div></div></section><section class="section"><div class="container"><h2 class="text-4xl font-medium text-center">Use async/await with URLSession</h2><blockquote class="max-w-prose my-4 md:my-6 lg:my-10 mx-auto text-center">Discover how you can adopt Swift concurrency in URLSession using async/await and AsyncSequence, and how you can apply Swift concurrency concepts to improve your networking code.</blockquote><p class="text-center"><video controls="" src="https://devstreaming-cdn.apple.com/videos/wwdc/2021/10095/7/2F07E69A-1CEF-4F48-9C63-E35F5DF4FBF7/cmaf.m3u8"></video><cite class="my-3 text-secondary text-sm"><a href="https://developer.apple.com/videos/play/wwdc2021/10095" target="_blank">WWDC21: Use async/await with URLSession</a></cite></p><h3 class="mt-10 md:mt-12 lg:mt-15 text-2xl">Notes</h3><div data-notes="use_async_await_with_urlsession" class="notes text-secondary">To be continued...</div></div></section><section class="section bg-blue-50"><div class="container"><div class="grid md:grid-cols-2 gap-6"><div><h2 class="text-2xl">Swift concurrency</h2><ul class="mt-4 list-disc list-inside text-primary"><li><a href="https://developer.apple.com/videos/play/wwdc2021/10017" target="_blank">Bring Core Data concurrency to Swift and SwiftUI</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10019" target="_blank">Discover concurrency in SwiftUI</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10134" target="_blank">Explore structured concurrency in Swift</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10133" target="_blank">Protect mutable state with Swift actors</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10254" target="_blank">Swift concurrency: Behind the scenes</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10194" target="_blank">Swift concurrency: Update a sample app</a></li></ul></div><div><h2 class="text-2xl">What's new</h2><ul class="mt-4 list-disc list-inside text-primary"><li><a href="https://developer.apple.com/videos/play/wwdc2021/10054" target="_blank">What's new in AppKit</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10086" target="_blank">What's new in CloudKit</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10192" target="_blank">What's new in Swift</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021/10146" target="_blank">What's new in AVFoundation</a></li><li><a href="https://developer.apple.com/videos/play/wwdc2021-10109" target="_blank">What's new in Foundation</a></li></ul></div></div><div class="pt-8 md:pt-12 lg:pt-20"><h2 class="text-2xl">Articles</h2><ul class="mt-4 list-disc list-inside text-primary"><li><a href="https://www.appcoda.com/asyncimage/">Using AsyncImage in SwiftUI for Loading Images Asynchronously</a> <cite class="ml-4">AppCoda</cite></li></ul></div></div></section><section class="section bg-gray-900"><div class="container text-center text-secondary"><div class="max-w-prose mx-auto"><p>Swift is a powerful and intuitive programming language for iOS, iPadOS, macOS, tvOS, and watchOS. <a class="text-primary" href="https://developer.apple.com/swift" target="_blank">Learn more...</a><br><a class="text-primary" href="https://swift.org">Join the Swift community.</a></p><p>WWDC is the Apple Worldwide Developers Conference. All the videos and some quotes are from Apple <a class="text-primary" href="https://developer.apple.com/wwdc21/" target="_blank">WWDC21</a>.</p><p class="my-4 text-sm">tryawait.com is made by a designer and iOS developer</p><p class="my-4 flex justify-center"><a href="https://www.github.com/tryawait/tryawait.github.io/blob/main/src/index.html" class="flex gap-2 pl-3 pr-4 py-1.5 bg-gray-600 rounded-full"><img height="16" width="16" src="https://cdn.jsdelivr.net/npm/simple-icons@v5/icons/github.svg"/> <span class="text-sm text-gray-900">Edit on GitHub</span></a></p></div></div></section></body></html>